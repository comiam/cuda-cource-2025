# Lab 4: Radix Sort

## Описание

Реализация поразрядной сортировки (Radix Sort) на CUDA для знаковых 32-битных целых чисел.

## Требования

- CUDA Toolkit 11.0+
- GPU с поддержкой CUDA
- Make

## Компиляция и запуск

```bash
make
./radixsort [n]
```

Параметр `n` — размер массива (по умолчанию 1000000).

## Результаты

```
Array size: 1000000

CPU qsort time:     0.0821 sec
GPU Radix Sort:     0.0156 sec
GPU thrust::sort:   0.0038 sec

Verification: PASSED

Speedup vs CPU:     5.3x
```

## Алгоритм

4-битный LSD Radix Sort (8 проходов для 32-битных чисел).

Для каждого прохода (каждые 4 бита):

1. **countDigits** — подсчёт гистограммы
2. **prefixSumAndOffset** — вычисление позиций
3. **computeRanksAndScatter** — перестановка элементов

## Функции

| Функция | Назначение |
|---------|------------|
| `countDigits` | Подсчёт количества элементов с каждым значением разряда (0-15) в каждом блоке. Использует shared memory и atomicAdd. |
| `prefixSumAndOffset` | Exclusive prefix sum по блокам для каждого разряда + глобальные смещения. Результат: позиция каждого блока в выходном массиве. |
| `computeRanksAndScatter` | Вычисление ранга каждого элемента внутри блока и запись в выходной массив. Ранг = количество элементов с тем же разрядом, идущих раньше. |
| `toUnsigned` | Преобразование signed → unsigned через XOR 0x80000000 (инверсия знакового бита). |
| `toSigned` | Обратное преобразование unsigned → signed. |
| `radixSortUnsigned` | Основной цикл сортировки: 8 проходов по 4 бита. |
| `radixSortSigned` | Обёртка для знаковых чисел: преобразование → сортировка → обратное преобразование. |

## Детали реализации

### Стабильность

Сортировка стабильная: элементы с одинаковым разрядом сохраняют относительный порядок. Достигается подсчётом ранга через цикл в shared memory:

```cpp
for (int i = 0; i < tid; i++) {
    if (sharedDigits[i] == myDigit) rank++;
}
```

### Обработка знаковых чисел

XOR с 0x80000000 инвертирует знаковый бит:
- Отрицательные числа (бит 1) становятся меньшими unsigned
- Положительные числа (бит 0) становятся большими unsigned

После сортировки unsigned порядок соответствует signed.

### Параметры

- `BLOCK_SIZE = 256` — потоков на блок
- `RADIX_BITS = 4` — бит за проход (16 возможных значений)
- 8 проходов для 32-битных чисел

## Сложность

- Время: O(w/r * n), где w=32 бита, r=4 бита → O(8n)
- Память: O(RADIX_SIZE * numBlocks) для счётчиков
