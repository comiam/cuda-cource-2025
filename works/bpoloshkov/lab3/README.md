# Lab 3: Sobel Operator

## Описание

Программа применяет оператор Собеля для обнаружения границ в изображении с использованием CUDA. Входное и выходное изображения в формате PGM (grayscale).

## Требования

- CUDA Toolkit 11.0+
- GPU с поддержкой CUDA
- Linux / macOS с nvcc
- Make

## Компиляция

```bash
make
```

## Запуск

```bash
./sobel <input.pgm> <output.pgm>
```

### Примеры

```bash
./sobel data/in.pgm data/out.pgm
```

## Результаты

```
Image: 225x225
Processing time: 0.05 ms
Result saved to: data/out.pgm
```

## Тестовые изображения

В директории `data/` находятся тестовые файлы:

| Файл | Описание |
|------|----------|
| `flower.jpg` | Исходное цветное изображение |
| `in.pgm` / `in.jpg` | Входное изображение (grayscale) |
| `out.pgm` / `out.jpg` | Результат применения оператора Собеля |

**Входное изображение:**

![Input](data/in.jpg)

**Результат — обнаруженные границы:**

![Output](data/out.jpg)

## Алгоритм

Оператор Собеля использует две свёрточные матрицы 3×3 для вычисления градиентов:

```
Gx = | -1  0  1 |    Gy = | -1 -2 -1 |
     | -2  0  2 |         |  0  0  0 |
     | -1  0  1 |         |  1  2  1 |
```

Для каждого пикселя:
1. Вычисляется горизонтальный градиент Gx (свёртка с первой матрицей)
2. Вычисляется вертикальный градиент Gy (свёртка со второй матрицей)
3. Итоговая магнитуда: `magnitude = sqrt(Gx^2 + Gy^2)`
4. Значение ограничивается диапазоном [0, 255]

Пиксели на границах изображения устанавливаются в 0.

## Формат PGM

PGM (Portable GrayMap) — простой формат для grayscale изображений:

```
P5
<width> <height>
<maxval>
<binary pixel data>
```

Для создания тестового изображения можно использовать ImageMagick:

```bash
convert input.jpg -colorspace Gray output.pgm
```

Или Python:

```python
from PIL import Image
img = Image.open('input.jpg').convert('L')
img.save('output.pgm')
```

## Используемые функции

| Функция | Описание |
|---------|----------|
| `cudaMalloc` | Выделяет память на GPU |
| `cudaMemcpy` | Копирует данные между CPU и GPU |
| `cudaEventCreate` | Создаёт событие для измерения времени |
| `cudaEventRecord` | Записывает событие в поток |
| `cudaEventElapsedTime` | Вычисляет время между событиями |
| `sqrtf` | Вычисляет квадратный корень (float) |

## Особенности реализации

- Размер блока: 16×16 потоков
- Каждый поток обрабатывает один пиксель
- Граничные пиксели (первая/последняя строка/столбец) устанавливаются в 0
- Поддержка изображений любого размера

